<loader loading="loading"></loader>
<div class="ldap_settings">
  <div class="row column">
    <h1>LDAP settings</h1>
    <div class="column small-12 page-header">
      <h2 class="inline h4">Manage role groups</h2>
    </div>
  </div>
  <div class="row column">
    <p>Manage role groups by selecting the corresponding checkbox and appropriate action.</p>
  </div>
  <div class="row column ldap__button__wrapper">
    <button id="add_group" class="btn-secondary group_btn" ng-class="{'disabled': !ldapConfig.ldapCurrentlyEnabled}" ng-click="activeModal='add'" role="button">Add Role Group</button>
    <button id="modify_group" class="btn-secondary group_btn" ng-class="{'disabled': (selectedGroups.length != 1) || !ldapConfig.ldapCurrentlyEnabled}" ng-click="activeModal='modify'" role="button">Modify Privileges</button>
    <button id="delete_group" class="btn-secondary group_btn" ng-class="{'disabled': (selectedGroups.length < 1) || !ldapConfig.ldapCurrentlyEnabled}" ng-click="activeModal='delete'" role="button">Remove Role {{selectedGroups.length > 1 ? 'Groups' : 'Group'}}</button>
    <button id="configure_settings" class="btn-secondary configure_btn" ng-click="activeModal='configure'" role="button">Configure LDAP Settings</button>
  </div>
  <div class="row column group__table table">
    <div class="table__head">
      <div class="table__row">
        <div class="table__cell group_select">
          <span class="table__cell-label">Select group:</span>
          <label class="control-check">
            <input type="checkbox" name="events__checkAll" ng-click="toggleAll()" ng-model="all"/>
            <span class="control__indicator"></span>
          </label>
        </div>
        <div class="table__cell group_label">
          <div class="column small-2 sort_button_wrapper">
            <button class="sort-ascending" ng-click="sortBy('id', false)"></button>
            <button class="sort-descending" ng-click="sortBy('id', true)"></button>
          </div>
            Role Group ID
        </div>
        <div class="table__cell group_label">
          <div class="column small-2 sort_button_wrapper">
            <button class="sort-ascending" ng-click="sortBy('groupName', false)"></button>
            <button class="sort-descending" ng-click="sortBy('groupName', true)"></button>
          </div>
          Group Name
        </div>
        <div class="table__cell group_label">
          <div class="column small-2 sort_button_wrapper">
            <button class="sort-ascending" ng-click="sortBy('privilege', false)"></button>
            <button class="sort-descending" ng-click="sortBy('privilege', true)"></button>
          </div>
          Group Privilege
        </div>
      </div>
    </div>
    <div class="table__body">
      <div class="table__row" ng-repeat="group in groups | orderBy:sortPropertyName:reverse">
        <div class="table__cell group_select">
          <span class="table__cell-label">Select group:</span>
          <label class="control-check">
            <input type="checkbox" name="events__check" ng-model="group.isSelected"/>
            <span class="control__indicator"></span>
          </label>
        </div>
        <div class="table__cell group_field">
          <span class="table__cell-label">Group id:</span>
          <span>{{group.id}}</span>
        </div>
        <div class="table__cell group_field">
          <span class="table__cell-label">Group name:</span>
          <span>{{group.groupName}}</span>
        </div>
        <div class="table__cell group_field">
          <span class="table__cell-label">Group privilege:</span>
          <span>{{group.privilege}}</span>
        </div>
      </div>
      <div class="groups_empty" ng-show="groups.length < 1">
        <p>No role groups have been created.</p>
        <a href ng-click="activeModal='configure'">LDAP authentication</a> must be enabled
        <br>before creating Role Groups.
      </div>
    </div>
  </div>
  <div class="row column">
    <p class="ldap__error" ng-show= "error" role="alert">
      Error : {{userMessage}}
    </p>
    <p class="ldap__success"  ng-show= "success" role="alert">
      Success : {{userMessage}}
    </p>
  </div>
  <div class="modal-overlay" ng-class="{'active': activeModal}"></div>
  <section class="modal modal-roles" aria-hidden="true" ng-class="{'active': activeModal, 'modal_configure': activeModal === 'configure'}">
    <div class="modal__activate" role="document">
      <div class="screen-reader-offscreen modal-description">Role Modal</div>
      <div ng-show="activeModal === 'add'">
        <div class="page-header ">
          <h1 class="h4 inline">Add Role Group</span>
          </h1>
        </div>
        <div class="modal__content">
          <form name="add_group">
            <label for="group-name">Group Name</label>
            <input id="group-name" class="small-6" type="text" ng-model="newGroup.name" required/>
            <label class="content-label">Group Privilege</label>
            <select ng-model="newGroup.privilege" class="small-6" required>
              <option ng-value="">Select an option</option>
              <option class="courier-bold" ng-repeat="privilege in userPrivileges">{{privilege}}</option>
            </select>
          </form>
        </div>
        <div class="modal__button-wrapper">
          <button class="inline btn-secondary" ng-click="activeModal=''; newGroup={}">Cancel</button>
          <button class="inline btn-primary" ng-class="{'disabled' : add_group.$invalid}" ng-click="saveGroupSettings();">Add group</button>
        </div>
      </div>
      <div ng-show="activeModal === 'delete'">
        <div class="page-header ">
          <div class="icon__warning inline"></div>
          <h1 class="h4 inline">Remove Role Group</h1>
        </div>
        <div class="modal__content">
          Are you sure you want to remove <span ng-repeat="group in selectedGroups">{{$last && !$first ? ' and ' : $first ? '': ', '}}{{"'" + group.groupName + "'"}}</span>?
        </div>
        <div class="modal__button-wrapper">
          <button class="inline btn-secondary" ng-click="activeModal=''; newGroup={}">Cancel</button>
          <button class="inline btn-primary" ng-click="saveGroupSettings();">Remove group</button>
        </div>
      </div>
      <div ng-show="activeModal === 'modify'">
        <div class="page-header ">
          <h1 class="h4 inline">Modify Role Privileges</h1>
        </div>
        <div class="modal__content">
          <form name="modify_group">
            <label class="content-label">Group Name</label>
            <span class="modify_group_name">{{getSelectedGroup().groupName}}</span>
            <label class="content-label">Group Privilege</label>
            <select ng-model="getSelectedGroup().privilege" class="small-6">
              <option class="courier-bold" ng-repeat="privilege in userPrivileges">{{privilege}}</option>
            </select>
          </form>
        </div>
        <div class="modal__button-wrapper">
          <button class="inline btn-secondary" ng-click="activeModal=''; loadLdapInfo();">Cancel</button>
          <button class="inline btn-primary" ng-click="saveGroupSettings();">Modify privileges</button>
        </div>
      </div>
      <div ng-show="activeModal === 'configure'">
        <div class="page-header ">
          <h1 class="h4 inline">Configure LDAP Settings</h1>
        </div>
        <ldap-configuration></ldap-configuration>
      </div>
    </div>
  </section>
</div>